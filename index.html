<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>3D Universe</title>
  <style>
    body { margin:0; overflow:hidden; background:black; color:white; font-family:sans-serif; }
    #menu {
      position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
      background:rgba(0,0,0,0.8); padding:20px; border:1px solid white;
      text-align:center; z-index:10;
    }
    input { margin:10px 0; }
    #startBtn { padding:8px 20px; cursor:pointer; }
    canvas { display:block; }
  </style>
</head>
<body>
  <!-- Menu ch·ªçn file -->
  <div id="menu">
    <h2>üåå Ch·ªçn nh·∫°c & ·∫£nh h√†nh tinh</h2>
    <input type="file" id="audioInput" accept="audio/*,video/*"><br>
    <input type="file" id="imageInput" accept="image/*" multiple><br>
    <button id="startBtn">B·∫Øt ƒë·∫ßu</button>
  </div>

  <canvas id="c"></canvas>

  <!-- Th∆∞ vi·ªán Three.js -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/OrbitControls.js"></script>

  <script>
    const menu = document.getElementById("menu");
    const canvas = document.getElementById("c");
    const btn = document.getElementById("startBtn");

    btn.onclick = () => {
      const file = document.getElementById("audioInput").files[0];
      const imgs = document.getElementById("imageInput").files;

      if (!file || imgs.length === 0) { alert("‚ö†Ô∏è Ch·ªçn nh·∫°c + ·∫£nh tr∆∞·ªõc!"); return; }

      // ph√°t nh·∫°c
      const audioURL = URL.createObjectURL(file);
      const audio = new Audio(audioURL);
      audio.loop = true;
      audio.play();

      // ·∫©n menu
      menu.style.display = "none";

      // kh·ªüi ch·∫°y 3D
      start3D(imgs);
    };

    function start3D(imgs) {
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 2000);
      camera.position.set(0, 100, 300);

      const renderer = new THREE.WebGLRenderer({canvas, antialias:true});
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(window.devicePixelRatio);

      // controls xoay + zoom
      const controls = new THREE.OrbitControls(camera, renderer.domElement);
      controls.enableDamping = true;
      controls.dampingFactor = 0.05;

      // √°nh s√°ng
      scene.add(new THREE.AmbientLight(0x404040, 2));
      const point = new THREE.PointLight(0xffffff, 2);
      point.position.set(200,200,200);
      scene.add(point);

      // n·ªÅn sao lung linh
      const starsGeo = new THREE.BufferGeometry();
      const starCount = 2000;
      const starPos = [];
      for (let i=0; i<starCount; i++){
        starPos.push((Math.random()-0.5)*2000);
        starPos.push((Math.random()-0.5)*2000);
        starPos.push((Math.random()-0.5)*2000);
      }
      starsGeo.setAttribute("position", new THREE.Float32BufferAttribute(starPos, 3));
      const starsMat = new THREE.PointsMaterial({color:0xffffff});
      const starField = new THREE.Points(starsGeo, starsMat);
      scene.add(starField);

      // h√†nh tinh trung t√¢m
      const centerGeo = new THREE.SphereGeometry(40, 64, 64);
      const centerMat = new THREE.MeshStandardMaterial({ color:0x3399ff, metalness:0.4, roughness:0.7 });
      const centerPlanet = new THREE.Mesh(centerGeo, centerMat);
      scene.add(centerPlanet);

      // c√°c h√†nh tinh xung quanh (·∫£nh ng∆∞·ªùi d√πng)
      const textureLoader = new THREE.TextureLoader();
      const planets = [];
      [...imgs].forEach((img, i) => {
        const url = URL.createObjectURL(img);
        const tex = textureLoader.load(url);
        const geo = new THREE.SphereGeometry(15, 32, 32);
        const mat = new THREE.MeshStandardMaterial({ map: tex });
        const mesh = new THREE.Mesh(geo, mat);
        const group = new THREE.Group();
        group.add(mesh);
        mesh.position.x = 100 + i*30; // b√°n k√≠nh qu·ªπ ƒë·∫°o kh√°c nhau
        scene.add(group);
        planets.push({ group, mesh, speed:0.01 + i*0.002 });
      });

      // animation
      function animate() {
        requestAnimationFrame(animate);

        // xoay trung t√¢m
        centerPlanet.rotation.y += 0.003;

        // h√†nh tinh quay quanh
        planets.forEach((p, idx) => {
          p.group.rotation.y += p.speed;
          p.mesh.rotation.y += 0.01;
        });

        controls.update();
        renderer.render(scene, camera);
      }
      animate();

      // hi·ªáu ·ª©ng zoom khi load
      camera.position.z = 1000;
      let t=0;
      function zoomIn(){
        if (t<1){
          t += 0.01;
          camera.position.z = 1000 - 700*t;
          requestAnimationFrame(zoomIn);
        }
      }
      zoomIn();

      window.addEventListener("resize", ()=>{
        camera.aspect = window.innerWidth/window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      });
    }
  </script>
</body>
</html>
