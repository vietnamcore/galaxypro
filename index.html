<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Hệ Mặt Trời Pastel 3D</title>
<style>
  body {margin:0;overflow:hidden;background:black;font-family:sans-serif;}
  #intro {
    position:absolute;top:40%;left:50%;transform:translate(-50%,-50%);
    color:#ff77ff;font-size:40px;font-weight:bold;
    text-shadow:0 0 10px #fff,0 0 20px #f0f,0 0 40px #f0f;
    animation:blink 1.5s infinite;
    z-index:10;cursor:pointer;
  }
  @keyframes blink {0%,100%{opacity:1;}50%{opacity:0.3;}}
  #musicControl {
    position:absolute;bottom:20px;left:20px;z-index:10;
    background:rgba(0,0,0,0.5);padding:10px;border-radius:8px;color:white;
  }
</style>
</head>
<body>
  <div id="intro">Chạm vào ↓</div>
  <div id="musicControl">
    <div>Chọn nhạc:</div>
    <input type="file" id="audioInput" accept=".mp3,.m4a"/>
    <audio id="audioPlayer" controls loop></audio>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.161.0/examples/js/controls/OrbitControls.js"></script>
  <script>
    // Scene setup
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 5000);
    camera.position.set(0,200,600);

    const renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enabled = false;

    // Starfield
    const numStars=6000;
    const starGeo=new THREE.BufferGeometry();
    const positions=new Float32Array(numStars*3);
    for(let i=0;i<numStars;i++){
      positions[i*3]=(Math.random()-0.5)*4000;
      positions[i*3+1]=(Math.random()-0.5)*4000;
      positions[i*3+2]=(Math.random()-0.5)*4000;
    }
    starGeo.setAttribute("position", new THREE.BufferAttribute(positions,3));
    const starMat=new THREE.PointsMaterial({color:0xffffff,size:1});
    scene.add(new THREE.Points(starGeo,starMat));

    // Lights
    scene.add(new THREE.AmbientLight(0x555555));
    const sunLight=new THREE.PointLight(0xffffff,2,2000);
    scene.add(sunLight);

    // Rainbow Sun
    const rainbowColors=[0xffadad,0xffd6a5,0xfdffb6,0xcaffbf,0x9bf6ff,0xa0c4ff,0xbdb2ff];
    const sunGeo=new THREE.SphereGeometry(30,64,64);
    const sunMat=new THREE.MeshPhongMaterial({color:0xffffaa,emissive:0xffee88,shininess:100});
    const sun=new THREE.Mesh(sunGeo,sunMat);
    scene.add(sun);

    // Planets pastel
    const planets=[];
    const planetData=[
      {size:6,distance:70,color:0xa4d4ff,speed:0.01,ring:false},
      {size:5,distance:110,color:0xffa3a3,speed:0.008,ring:true},
      {size:7,distance:160,color:0xcaffbf,speed:0.006,ring:false},
      {size:9,distance:220,color:0x9bf6ff,speed:0.004,ring:true},
    ];
    planetData.forEach((p,i)=>{
      const mat=new THREE.MeshPhongMaterial({color:p.color,shininess:80});
      const mesh=new THREE.Mesh(new THREE.SphereGeometry(p.size,32,32),mat);
      mesh.position.x=p.distance;
      scene.add(mesh);

      let ring=null;
      if(p.ring){
        const ringGeo=new THREE.RingGeometry(p.size*1.4,p.size*2.0,64);
        const ringMat=new THREE.MeshBasicMaterial({color:p.color,side:THREE.DoubleSide,transparent:true,opacity:0.7});
        ring=new THREE.Mesh(ringGeo,ringMat);
        ring.rotation.x=Math.PI/2;
        mesh.add(ring);
      }

      planets.push({mesh:mesh,angle:Math.random()*Math.PI*2,distance:p.distance,speed:p.speed});
    });

    // Intro zoom
    let introActive=true;
    const intro=document.getElementById("intro");
    intro.addEventListener("click",()=>{
      intro.style.display="none";
      introActive=false;
      controls.enabled=true;
    });

    // Animate
    function animate(){
      requestAnimationFrame(animate);

      // Sun rainbow effect
      const t=Date.now()*0.001;
      sun.material.color.setHex(rainbowColors[Math.floor(t)%rainbowColors.length]);

      // Planet orbits
      planets.forEach(p=>{
        p.angle+=p.speed;
        p.mesh.position.x=Math.cos(p.angle)*p.distance;
        p.mesh.position.z=Math.sin(p.angle)*p.distance;
      });

      // Camera zoom
      if(introActive && camera.position.z>300){
        camera.position.z-=1.5;
        camera.position.y-=0.5;
      }

      renderer.render(scene,camera);
    }
    animate();

    // Resize
    window.addEventListener("resize",()=>{
      camera.aspect=window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // Audio
    const audioInput=document.getElementById("audioInput");
    const audioPlayer=document.getElementById("audioPlayer");
    audioInput.addEventListener("change", e=>{
      const file=e.target.files[0];
      if(file){
        const url=URL.createObjectURL(file);
        audioPlayer.src=url;
        audioPlayer.play().catch(()=>{});
      }
    });
  </script>
</body>
</html>
