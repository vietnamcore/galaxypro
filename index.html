<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>3D Planet Gallery</title>
  <style>
    body { margin: 0; overflow: hidden; background: black; }
    #menu {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.9); color: white; display: flex;
      flex-direction: column; align-items: center; justify-content: center;
      z-index: 20;
    }
    #menu h1 { margin-bottom: 20px; }
    #menu input { margin: 10px; }
    #menu button {
      padding: 10px 20px; font-size: 16px; margin-top: 20px;
      cursor: pointer; border: none; background: #2266ff; color: white;
      border-radius: 5px;
    }
    canvas { display: block; }
  </style>
</head>
<body>
<div id="menu">
  <h1>üöÄ 3D Planet Gallery</h1>
  <label>Ch·ªçn ·∫£nh (nhi·ªÅu ·∫£nh):</label>
  <input type="file" id="imageInput" multiple accept="image/*"><br>
  <label>Ch·ªçn nh·∫°c (MP3/MP4):</label>
  <input type="file" id="mediaInput" accept="audio/*,video/*"><br>
  <button onclick="startExperience()">Start</button>
</div>

<audio id="audio" controls style="display:none"></audio>
<video id="video" controls style="display:none"></video>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js"></script>

<script>
let scene, camera, renderer, controls;
let planet, group;
let mediaElement;

function startExperience() {
  document.getElementById("menu").style.display = "none";

  // l·∫•y file nh·∫°c
  const file = document.getElementById("mediaInput").files[0];
  if (file) {
    const url = URL.createObjectURL(file);
    if (file.type.startsWith("audio")) {
      mediaElement = document.getElementById("audio");
    } else {
      mediaElement = document.getElementById("video");
    }
    mediaElement.src = url;
    mediaElement.play();
  }

  init3D();
  animate();
}

function init3D() {
  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 2000);
  camera.position.set(0, 0, 0.5);

  renderer = new THREE.WebGLRenderer({antialias: true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  controls = new THREE.OrbitControls(camera, renderer.domElement);

  // √°nh s√°ng
  const light = new THREE.PointLight(0xffffff, 1);
  light.position.set(10, 10, 10);
  scene.add(light);

  // h√†nh tinh ch√≠nh
  const planetGeo = new THREE.SphereGeometry(1, 64, 64);
  const planetMat = new THREE.MeshPhongMaterial({color: 0x2266ff, shininess: 100});
  planet = new THREE.Mesh(planetGeo, planetMat);
  scene.add(planet);

  // group ch·ª©a ·∫£nh
  group = new THREE.Group();
  scene.add(group);

  // load ·∫£nh ng∆∞·ªùi d√πng ch·ªçn
  const files = document.getElementById("imageInput").files;
  const textureLoader = new THREE.TextureLoader();

  for (let i = 0; i < files.length; i++) {
    const url = URL.createObjectURL(files[i]);
    const tex = textureLoader.load(url);
    const plane = new THREE.Mesh(
      new THREE.PlaneGeometry(0.6, 0.6),
      new THREE.MeshBasicMaterial({map: tex, side: THREE.DoubleSide})
    );
    const angle = i * (Math.PI * 2 / files.length);
    plane.position.set(Math.cos(angle)*3, Math.sin(angle)*3, 0);
    group.add(plane);
  }

  // hi·ªáu ·ª©ng camera zoom ra
  let targetZ = 6;
  function zoomOut() {
    if (camera.position.z < targetZ) {
      camera.position.z += 0.05;
      requestAnimationFrame(zoomOut);
    }
  }
  zoomOut();

  window.addEventListener('resize', onWindowResize);
}

function onWindowResize() {
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}

function animate() {
  requestAnimationFrame(animate);
  if (planet) planet.rotation.y += 0.003;
  if (group) group.rotation.y += 0.01;
  controls.update();
  renderer.render(scene, camera);
}
</script>
</body>
</html>
